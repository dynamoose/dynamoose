const {expect} = require("chai");
const utils = require("../../lib/utils");

describe("utils.merge_objects", () => {
	it("Should be a function", () => {
		expect(utils.merge_objects).to.be.a("function");
	});

	const tests = [
		{
			"input": [{"a": [{"a": "b"}, {"a": "c"}], "b": 2, "c": {"a": "c"}}, {"a": [{"a": "d"}, {"a": "e"}, {"a": "f"}], "b": 3, "c": {"a": "f"}}],
			"output": {"a": [{"a": "b"}, {"a": "c"}, {"a": "d"}, {"a": "e"}, {"a": "f"}], "b": 5, "c": [{"a": "c"}, {"a": "f"}]}
		},
		{
			"input": [{"a": [{"a": "b"}, {"a": "c"}], "b": 2, "c": {"a": "c"}}, {"a": [{"a": "d"}, {"a": "e"}, {"a": "f"}], "b": 3}],
			"output": {"a": [{"a": "b"}, {"a": "c"}, {"a": "d"}, {"a": "e"}, {"a": "f"}], "b": 5, "c": {"a": "c"}}
		},
		{
			"input": [{"a": [{"a": "b"}, {"a": "c"}], "b": 2, "c": {"a": "c"}}, {"a": [{"a": "d"}, {"a": "e"}, {"a": "f"}], "b": 3, "c": {"a": "f"}}, {"a": [{"a": "g"}, {"a": "h"}, {"a": "i"}, {"a": "z"}], "b": 4}],
			"output": {"a": [{"a": "b"}, {"a": "c"}, {"a": "d"}, {"a": "e"}, {"a": "f"}, {"a": "g"}, {"a": "h"}, {"a": "i"}, {"a": "z"}], "b": 9, "c": [{"a": "c"}, {"a": "f"}]}
		},
		// TODO: figure out how to reproduce this test in a smaller size
		// This was failing without the `else if (Array.isArray(returnObject[key]))` section in `merge_objects` and had to implement it in order to fix this failing case
		{
			"input": [{"Items":[{"id":{"N":"973"}},{"id":{"N":"43"}},{"id":{"N":"352"}},{"id":{"N":"930"}},{"id":{"N":"517"}},{"id":{"N":"820"}},{"id":{"N":"512"}},{"id":{"N":"380"}},{"id":{"N":"790"}},{"id":{"N":"521"}},{"id":{"N":"122"}},{"id":{"N":"710"}},{"id":{"N":"589"}},{"id":{"N":"280"}},{"id":{"N":"90"}},{"id":{"N":"890"}},{"id":{"N":"435"}},{"id":{"N":"179"}},{"id":{"N":"157"}},{"id":{"N":"985"}},{"id":{"N":"201"}}],"Count":21,"ScannedCount":21,"LastEvaluatedKey":{"id":{"N":"201"}}},{"Items":[{"id":{"N":"232"}},{"id":{"N":"798"}},{"id":{"N":"653"}},{"id":{"N":"788"}},{"id":{"N":"450"}},{"id":{"N":"667"}},{"id":{"N":"914"}},{"id":{"N":"489"}},{"id":{"N":"597"}},{"id":{"N":"562"}},{"id":{"N":"728"}},{"id":{"N":"97"}},{"id":{"N":"739"}},{"id":{"N":"347"}},{"id":{"N":"638"}},{"id":{"N":"664"}},{"id":{"N":"137"}},{"id":{"N":"393"}},{"id":{"N":"866"}},{"id":{"N":"373"}},{"id":{"N":"619"}}],"Count":21,"ScannedCount":21,"LastEvaluatedKey":{"id":{"N":"619"}}},{"Items":[{"id":{"N":"720"}},{"id":{"N":"210"}},{"id":{"N":"334"}},{"id":{"N":"172"}},{"id":{"N":"317"}},{"id":{"N":"295"}},{"id":{"N":"703"}},{"id":{"N":"473"}},{"id":{"N":"762"}},{"id":{"N":"945"}},{"id":{"N":"651"}},{"id":{"N":"516"}},{"id":{"N":"867"}},{"id":{"N":"454"}},{"id":{"N":"28"}},{"id":{"N":"912"}},{"id":{"N":"704"}},{"id":{"N":"46"}},{"id":{"N":"331"}},{"id":{"N":"523"}},{"id":{"N":"346"}}],"Count":21,"ScannedCount":21,"LastEvaluatedKey":{"id":{"N":"346"}}},{"Items":[{"id":{"N":"553"}},{"id":{"N":"713"}},{"id":{"N":"229"}},{"id":{"N":"107"}},{"id":{"N":"677"}},{"id":{"N":"856"}},{"id":{"N":"299"}},{"id":{"N":"64"}},{"id":{"N":"722"}},{"id":{"N":"838"}},{"id":{"N":"888"}},{"id":{"N":"39"}},{"id":{"N":"147"}},{"id":{"N":"778"}},{"id":{"N":"72"}},{"id":{"N":"559"}},{"id":{"N":"906"}},{"id":{"N":"937"}},{"id":{"N":"311"}},{"id":{"N":"7"}},{"id":{"N":"237"}}],"Count":21,"ScannedCount":21,"LastEvaluatedKey":{"id":{"N":"237"}}},{"Items":[{"id":{"N":"909"}},{"id":{"N":"847"}},{"id":{"N":"789"}},{"id":{"N":"121"}},{"id":{"N":"656"}},{"id":{"N":"253"}},{"id":{"N":"22"}},{"id":{"N":"500"}},{"id":{"N":"815"}},{"id":{"N":"302"}},{"id":{"N":"745"}},{"id":{"N":"999"}},{"id":{"N":"714"}},{"id":{"N":"494"}},{"id":{"N":"681"}},{"id":{"N":"729"}},{"id":{"N":"744"}},{"id":{"N":"24"}},{"id":{"N":"217"}},{"id":{"N":"692"}},{"id":{"N":"983"}}],"Count":21,"ScannedCount":21,"LastEvaluatedKey":{"id":{"N":"983"}}},{"Items":[{"id":{"N":"752"}},{"id":{"N":"341"}},{"id":{"N":"957"}},{"id":{"N":"169"}},{"id":{"N":"359"}},{"id":{"N":"749"}},{"id":{"N":"654"}},{"id":{"N":"65"}},{"id":{"N":"235"}},{"id":{"N":"686"}},{"id":{"N":"738"}},{"id":{"N":"477"}},{"id":{"N":"590"}},{"id":{"N":"123"}},{"id":{"N":"831"}},{"id":{"N":"411"}},{"id":{"N":"756"}},{"id":{"N":"556"}},{"id":{"N":"0"}},{"id":{"N":"197"}},{"id":{"N":"996"}}],"Count":21,"ScannedCount":21,"LastEvaluatedKey":{"id":{"N":"996"}}},{"Items":[{"id":{"N":"250"}},{"id":{"N":"623"}},{"id":{"N":"814"}},{"id":{"N":"807"}},{"id":{"N":"803"}},{"id":{"N":"383"}},{"id":{"N":"379"}},{"id":{"N":"548"}},{"id":{"N":"583"}},{"id":{"N":"835"}},{"id":{"N":"224"}},{"id":{"N":"895"}},{"id":{"N":"402"}},{"id":{"N":"542"}},{"id":{"N":"724"}},{"id":{"N":"952"}},{"id":{"N":"248"}},{"id":{"N":"314"}},{"id":{"N":"76"}},{"id":{"N":"676"}},{"id":{"N":"258"}}],"Count":21,"ScannedCount":21,"LastEvaluatedKey":{"id":{"N":"258"}}},{"Items":[{"id":{"N":"231"}},{"id":{"N":"725"}},{"id":{"N":"183"}},{"id":{"N":"73"}},{"id":{"N":"932"}},{"id":{"N":"660"}},{"id":{"N":"969"}},{"id":{"N":"113"}},{"id":{"N":"144"}},{"id":{"N":"361"}},{"id":{"N":"374"}},{"id":{"N":"371"}},{"id":{"N":"586"}},{"id":{"N":"385"}},{"id":{"N":"954"}},{"id":{"N":"673"}},{"id":{"N":"546"}},{"id":{"N":"779"}},{"id":{"N":"699"}},{"id":{"N":"74"}},{"id":{"N":"483"}}],"Count":21,"ScannedCount":21,"LastEvaluatedKey":{"id":{"N":"483"}}},{"Items":[{"id":{"N":"366"}},{"id":{"N":"110"}},{"id":{"N":"282"}},{"id":{"N":"234"}},{"id":{"N":"261"}},{"id":{"N":"934"}},{"id":{"N":"437"}},{"id":{"N":"140"}},{"id":{"N":"702"}},{"id":{"N":"769"}},{"id":{"N":"747"}},{"id":{"N":"900"}},{"id":{"N":"766"}},{"id":{"N":"268"}},{"id":{"N":"453"}},{"id":{"N":"683"}},{"id":{"N":"471"}},{"id":{"N":"481"}},{"id":{"N":"21"}},{"id":{"N":"345"}},{"id":{"N":"594"}}],"Count":21,"ScannedCount":21,"LastEvaluatedKey":{"id":{"N":"594"}}},{"Items":[{"id":{"N":"316"}},{"id":{"N":"246"}},{"id":{"N":"143"}},{"id":{"N":"612"}},{"id":{"N":"708"}},{"id":{"N":"886"}},{"id":{"N":"929"}},{"id":{"N":"564"}},{"id":{"N":"775"}},{"id":{"N":"884"}},{"id":{"N":"296"}},{"id":{"N":"848"}},{"id":{"N":"358"}},{"id":{"N":"741"}},{"id":{"N":"997"}},{"id":{"N":"390"}},{"id":{"N":"433"}},{"id":{"N":"273"}},{"id":{"N":"236"}},{"id":{"N":"18"}},{"id":{"N":"404"}}],"Count":21,"ScannedCount":21,"LastEvaluatedKey":{"id":{"N":"404"}}}],
			"output": {"Count": 210, "ScannedCount": 210, "LastEvaluatedKey": [{"id":{"N":"201"}},{"id":{"N":"619"}},{"id":{"N":"346"}},{"id":{"N":"237"}},{"id":{"N":"983"}},{"id":{"N":"996"}},{"id":{"N":"258"}},{"id":{"N":"483"}},{"id":{"N":"594"}}, {"id":{"N":"404"}}], "Items": [{"id":{"N":"973"}},{"id":{"N":"43"}},{"id":{"N":"352"}},{"id":{"N":"930"}},{"id":{"N":"517"}},{"id":{"N":"820"}},{"id":{"N":"512"}},{"id":{"N":"380"}},{"id":{"N":"790"}},{"id":{"N":"521"}},{"id":{"N":"122"}},{"id":{"N":"710"}},{"id":{"N":"589"}},{"id":{"N":"280"}},{"id":{"N":"90"}},{"id":{"N":"890"}},{"id":{"N":"435"}},{"id":{"N":"179"}},{"id":{"N":"157"}},{"id":{"N":"985"}},{"id":{"N":"201"}},{"id":{"N":"232"}},{"id":{"N":"798"}},{"id":{"N":"653"}},{"id":{"N":"788"}},{"id":{"N":"450"}},{"id":{"N":"667"}},{"id":{"N":"914"}},{"id":{"N":"489"}},{"id":{"N":"597"}},{"id":{"N":"562"}},{"id":{"N":"728"}},{"id":{"N":"97"}},{"id":{"N":"739"}},{"id":{"N":"347"}},{"id":{"N":"638"}},{"id":{"N":"664"}},{"id":{"N":"137"}},{"id":{"N":"393"}},{"id":{"N":"866"}},{"id":{"N":"373"}},{"id":{"N":"619"}},{"id":{"N":"720"}},{"id":{"N":"210"}},{"id":{"N":"334"}},{"id":{"N":"172"}},{"id":{"N":"317"}},{"id":{"N":"295"}},{"id":{"N":"703"}},{"id":{"N":"473"}},{"id":{"N":"762"}},{"id":{"N":"945"}},{"id":{"N":"651"}},{"id":{"N":"516"}},{"id":{"N":"867"}},{"id":{"N":"454"}},{"id":{"N":"28"}},{"id":{"N":"912"}},{"id":{"N":"704"}},{"id":{"N":"46"}},{"id":{"N":"331"}},{"id":{"N":"523"}},{"id":{"N":"346"}},{"id":{"N":"553"}},{"id":{"N":"713"}},{"id":{"N":"229"}},{"id":{"N":"107"}},{"id":{"N":"677"}},{"id":{"N":"856"}},{"id":{"N":"299"}},{"id":{"N":"64"}},{"id":{"N":"722"}},{"id":{"N":"838"}},{"id":{"N":"888"}},{"id":{"N":"39"}},{"id":{"N":"147"}},{"id":{"N":"778"}},{"id":{"N":"72"}},{"id":{"N":"559"}},{"id":{"N":"906"}},{"id":{"N":"937"}},{"id":{"N":"311"}},{"id":{"N":"7"}},{"id":{"N":"237"}},{"id":{"N":"909"}},{"id":{"N":"847"}},{"id":{"N":"789"}},{"id":{"N":"121"}},{"id":{"N":"656"}},{"id":{"N":"253"}},{"id":{"N":"22"}},{"id":{"N":"500"}},{"id":{"N":"815"}},{"id":{"N":"302"}},{"id":{"N":"745"}},{"id":{"N":"999"}},{"id":{"N":"714"}},{"id":{"N":"494"}},{"id":{"N":"681"}},{"id":{"N":"729"}},{"id":{"N":"744"}},{"id":{"N":"24"}},{"id":{"N":"217"}},{"id":{"N":"692"}},{"id":{"N":"983"}},{"id":{"N":"752"}},{"id":{"N":"341"}},{"id":{"N":"957"}},{"id":{"N":"169"}},{"id":{"N":"359"}},{"id":{"N":"749"}},{"id":{"N":"654"}},{"id":{"N":"65"}},{"id":{"N":"235"}},{"id":{"N":"686"}},{"id":{"N":"738"}},{"id":{"N":"477"}},{"id":{"N":"590"}},{"id":{"N":"123"}},{"id":{"N":"831"}},{"id":{"N":"411"}},{"id":{"N":"756"}},{"id":{"N":"556"}},{"id":{"N":"0"}},{"id":{"N":"197"}},{"id":{"N":"996"}},{"id":{"N":"250"}},{"id":{"N":"623"}},{"id":{"N":"814"}},{"id":{"N":"807"}},{"id":{"N":"803"}},{"id":{"N":"383"}},{"id":{"N":"379"}},{"id":{"N":"548"}},{"id":{"N":"583"}},{"id":{"N":"835"}},{"id":{"N":"224"}},{"id":{"N":"895"}},{"id":{"N":"402"}},{"id":{"N":"542"}},{"id":{"N":"724"}},{"id":{"N":"952"}},{"id":{"N":"248"}},{"id":{"N":"314"}},{"id":{"N":"76"}},{"id":{"N":"676"}},{"id":{"N":"258"}},{"id":{"N":"231"}},{"id":{"N":"725"}},{"id":{"N":"183"}},{"id":{"N":"73"}},{"id":{"N":"932"}},{"id":{"N":"660"}},{"id":{"N":"969"}},{"id":{"N":"113"}},{"id":{"N":"144"}},{"id":{"N":"361"}},{"id":{"N":"374"}},{"id":{"N":"371"}},{"id":{"N":"586"}},{"id":{"N":"385"}},{"id":{"N":"954"}},{"id":{"N":"673"}},{"id":{"N":"546"}},{"id":{"N":"779"}},{"id":{"N":"699"}},{"id":{"N":"74"}},{"id":{"N":"483"}},{"id":{"N":"366"}},{"id":{"N":"110"}},{"id":{"N":"282"}},{"id":{"N":"234"}},{"id":{"N":"261"}},{"id":{"N":"934"}},{"id":{"N":"437"}},{"id":{"N":"140"}},{"id":{"N":"702"}},{"id":{"N":"769"}},{"id":{"N":"747"}},{"id":{"N":"900"}},{"id":{"N":"766"}},{"id":{"N":"268"}},{"id":{"N":"453"}},{"id":{"N":"683"}},{"id":{"N":"471"}},{"id":{"N":"481"}},{"id":{"N":"21"}},{"id":{"N":"345"}},{"id":{"N":"594"}},{"id":{"N":"316"}},{"id":{"N":"246"}},{"id":{"N":"143"}},{"id":{"N":"612"}},{"id":{"N":"708"}},{"id":{"N":"886"}},{"id":{"N":"929"}},{"id":{"N":"564"}},{"id":{"N":"775"}},{"id":{"N":"884"}},{"id":{"N":"296"}},{"id":{"N":"848"}},{"id":{"N":"358"}},{"id":{"N":"741"}},{"id":{"N":"997"}},{"id":{"N":"390"}},{"id":{"N":"433"}},{"id":{"N":"273"}},{"id":{"N":"236"}},{"id":{"N":"18"}},{"id":{"N":"404"}}]}
		},
		{
			"input": [[1, 2], {"a": "b"}],
			"error": "You can't mix value types for the merge_objects method."
		},
		{
			"input": [{"a": "b"}, [1, 2]],
			"error": "You can't mix value types for the merge_objects method."
		},
		{
			"input": [1],
			"error": "You can only pass objects into merge_objects method."
		}
	];

	tests.forEach((test) => {
		if (test.error) {
			it(`Should throw error for ${JSON.stringify(test.input)}`, () => {
				expect(() => utils.merge_objects(...test.input)).to.throw(test.error);
			});
		} else {
			it(`Should return ${JSON.stringify(test.output)} for ${JSON.stringify(test.input)}`, () => {
				expect(utils.merge_objects(...test.input)).to.eql(test.output);
			});
		}
	});
});
